

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Lesson 41. Apps for controlling external devices &mdash; Programming Bootcamp  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lesson 42: Control panels" href="l42_control_panels.html" />
    <link rel="prev" title="Lesson 40: Control of external devices" href="l40_serial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #F1F2D8" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Lessons</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="l00_configuring_your_computer.html">Lesson 0: Configuring your computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="l01_welcome.html">Lesson 1: Welcome and Introduction to JupyterLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="l02_basic_command_line_skills.html">Lesson 2: Basic command line skills</a></li>
<li class="toctree-l1"><a class="reference internal" href="l03_variables_operators_types.html">Lesson 3: Variables, operators, and types</a></li>
<li class="toctree-l1"><a class="reference internal" href="l04_more_operators_and_conditionals.html">Lesson 4: More operators and conditionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="l05_lists_and_tuples.html">Lesson 5: Lists and tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="l06_iteration.html">Lesson 6: Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="l07_intro_to_functions.html">Lesson 7: Introduction to functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="l08_string_methods.html">Lesson 8: String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="l09_dictionaries.html">Lesson 9: Dictionaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="l10_packages_and_modules.html">Lesson 10: Packages and modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="l11_file_io.html">Lesson 11: File I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="l12_version_control_with_git.html">Lesson 12: Version control with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="l13_exceptions_and_error_handling.html">Lesson 13: Errors and Exception handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="l16_style.html">Lesson 16: Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="l17_intro_to_pandas.html">Lesson 17: Introduction to Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="l18_split_apply_combine.html">Lesson 18: Tidy data and split-apply-combine</a></li>
<li class="toctree-l1"><a class="reference internal" href="l19_plotting.html">Lesson 19: Making plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="l20_high_level_plotting.html">Lesson 20: High level plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="l21_intro_to_numpy_and_scipy.html">Lesson 21: Introduction to Numpy and Scipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="l22_plotting_time_series_generated_data.html">Lesson 22: Plotting time series and generated data</a></li>
<li class="toctree-l1"><a class="reference internal" href="l23_random_number_generation.html">Lesson 23: Random number generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="l24_comprehensions.html">Lesson 24: Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="l25_hackerstats_1.html">Lesson 25: Hacker stats I</a></li>
<li class="toctree-l1"><a class="reference internal" href="l26_hackerstats_2.html">Lesson 26: Hacker stats II</a></li>
<li class="toctree-l1"><a class="reference internal" href="l27_holoviews.html">Lesson 27: High level plotting with HoloViews</a></li>
<li class="toctree-l1"><a class="reference internal" href="l28_overplotting.html">Lesson 28: Dealing with overplotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="l38_intro_to_image_processing.html">Lesson 38: Introduction to image processing with scikit-image</a></li>
<li class="toctree-l1"><a class="reference internal" href="l39_segmentation.html">Lesson 39: Basic image quantification</a></li>
<li class="toctree-l1"><a class="reference internal" href="l32_other_packages_and_languages.html">Lesson 32: Survey of other packages and languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="l33_bootcamp_recap.html">Lesson 33: Bootcamp recap</a></li>
</ul>
<p class="caption"><span class="caption-text">Auxiliary lessons</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="l30_javascript_for_bokeh.html">Lesson 30: JavaScript for stand-alone Bokeh apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="l31_intro_to_scripting.html">Lesson 31: Introduction to scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="l34_more_command_line.html">Lesson 34: More about the command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="l35_regular_expressions.html">Lesson 35: Regular expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="l36_intro_to_oop.html">Lesson 36: Introduction to object-oriented programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="l37_algorithmic_complexity.html">Lesson 37: Algorithmic complexity</a></li>
<li class="toctree-l1"><a class="reference internal" href="l40_serial.html">Lesson 40: Control of external devices</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lesson 41. Apps for controlling external devices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Why-do-we-need-asynchrony?">Why do we need asynchrony?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Reading-data-in-chunks">Reading data in chunks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Chunk-reading-for-non-corrupted-data">Chunk reading for non-corrupted data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Chunk-reading-with-corrupted-data">Chunk reading with corrupted data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#asyncio">asyncio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Canceling-a-task">Canceling a task</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Running-without-an-existing-event-loop">Running without an existing event loop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Receiving-data-asynchronously">Receiving data asynchronously</a></li>
<li class="toctree-l2"><a class="reference internal" href="#App-with-live-updates">App with live updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Computing-environment">Computing environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="l42_control_panels.html">Lesson 42: Control panels</a></li>
<li class="toctree-l1"><a class="reference internal" href="l14_testing_and_tdd.html">Lesson 14: Testing and test-driven development</a></li>
<li class="toctree-l1"><a class="reference internal" href="l15_examples_of_tdd.html">Lesson 15: Examples of TDD</a></li>
<li class="toctree-l1"><a class="reference internal" href="l29_dashboards.html">Lesson 29: Dashboards</a></li>
</ul>
<p class="caption"><span class="caption-text">Exercises</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_1/index.html">Exercise 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_2/index.html">Exercise 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_3/index.html">Exercise 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_4/index.html">Exercise 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_5/index.html">Exercise 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_6/index.html">Exercise 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_7/index.html">Exercise 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_8/index.html">Exercise 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_9/index.html">Exercise 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/exercise_10/index.html">Exercise 10</a></li>
</ul>
<p class="caption"><span class="caption-text">Exercise solutions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_1/index.html">Exercise 1 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_2/index.html">Exercise 2 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_3/index.html">Exercise 3 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_4/index.html">Exercise 4 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_5/index.html">Exercise 5 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_6/index.html">Exercise 6 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_7/index.html">Exercise 7 solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercise_solutions/exercise_8/index.html">Exercise 8 solutions</a></li>
</ul>
<p class="caption"><span class="caption-text">Schedule</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">Schedule overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html#daily-schedule">Daily schedule</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Scientific Python distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html#online-instruction">Online instruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html#books">Books</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html#griffin-chure-s-templates-for-reproducible-publishing">Griffin Chure’s templates for reproducible publishing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Programming Bootcamp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Lesson 41. Apps for controlling external devices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/lessons/l41_serial_apps.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Lesson-41.-Apps-for-controlling-external-devices">
<h1>Lesson 41. Apps for controlling external devices<a class="headerlink" href="#Lesson-41.-Apps-for-controlling-external-devices" title="Permalink to this headline">¶</a></h1>
<hr><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">serial.tools.list_ports</span>

<span class="kn">import</span> <span class="nn">bokeh.plotting</span>
<span class="kn">import</span> <span class="nn">bokeh.io</span>
<span class="kn">import</span> <span class="nn">bokeh.driving</span>

<span class="n">notebook_url</span> <span class="o">=</span> <span class="s1">&#39;localhost:8888&#39;</span>
<span class="n">bokeh</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="1002">Loading BokehJS ...</span>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

(function(root) {
  function now() {
    return new Date();
  }

  var force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

  var JS_MIME_TYPE = 'application/javascript';
  var HTML_MIME_TYPE = 'text/html';
  var EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  var CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    var script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    var cell = handle.cell;

    var id = cell.output_area._bokeh_element_id;
    var server_id = cell.output_area._bokeh_server_id;
    // Clean up Bokeh references
    if (id != null && id in Bokeh.index) {
      Bokeh.index[id].model.document.clear();
      delete Bokeh.index[id];
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      var cmd = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd, {
        iopub: {
          output: function(msg) {
            var id = msg.content.text.trim();
            if (id in Bokeh.index) {
              Bokeh.index[id].model.document.clear();
              delete Bokeh.index[id];
            }
          }
        }
      });
      // Destroy server and session
      var cmd = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    var output_area = handle.output_area;
    var output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      var bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      var script_attrs = bk_div.children[0].attributes;
      for (var i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      var toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }


  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  var NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded() {
    var el = document.getElementById("1002");
    if (el != null) {
      el.textContent = "BokehJS is loading...";
    }
    if (root.Bokeh !== undefined) {
      if (el != null) {
        el.textContent = "BokehJS " + root.Bokeh.version + " successfully loaded.";
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(display_loaded, 100)
    }
  }


  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    const hashes = {"https://cdn.bokeh.org/bokeh/release/bokeh-2.3.2.min.js": "XypntL49z55iwGVUW4qsEu83zKL3XEcz0MjuGOQ9SlaaQ68X/g+k1FcioZi7oQAc", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.3.2.min.js": "bEsM86IHGDTLCS0Zod8a8WM6Y4+lafAL/eSiyQcuPzinmWNgNO2/olUF0Z2Dkn5i", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.3.2.min.js": "TX0gSQTdXTTeScqxj6PVQxTiRW8DOoGVwinyi1D3kxv7wuxQ02XkOxv0xwiypcAH"};

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      if (url in hashes) {
        element.crossOrigin = "anonymous";
        element.integrity = "sha384-" + hashes[url];
      }
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }


  var js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-2.3.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.3.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.3.2.min.js"];
  var css_urls = [];


  var inline_js = [
    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
    function(Bokeh) {


    }
  ];

  function run_inline_js() {

    if (root.Bokeh !== undefined || force === true) {

    for (var i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }
    if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      var cell = $(document.getElementById("1002")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }

  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));
</script></div>
</div>
<hr><p>In this lesson, you will learn how to use Python’s built-in asynchronous capabilities to constantly receive data from Arduino without blocking so that you can use the Python interpreter to do other tasks.</p>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<p>The setup for this lesson is the same as the previous one. As a reminder, you should have an Arduino Uno board with the setup below connected to a USB port on your computer.</p>
<div style="margin: auto; width: 400px;"><img alt="Arduino" src="../_images/arduino_setup.svg" /></div><p>You should also have the following code uploaded onto your Arduino.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="kt">int</span> <span class="n">voltagePin</span> <span class="o">=</span> <span class="n">A0</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">redLEDPin</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">greenLEDPin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">HANDSHAKE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">VOLTAGE_REQUEST</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">RED_LED_ON</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">RED_LED_OFF</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">GREEN_LED_ON</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">GREEN_LED_OFF</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">ON_REQUEST</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">STREAM</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">READ_DAQ_DELAY</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

<span class="n">String</span> <span class="n">daqDelayStr</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">inByte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">daqMode</span> <span class="o">=</span> <span class="n">ON_REQUEST</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">daqDelay</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>   <span class="c1">// delay between acquisitions in milliseconds</span>

<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">time_ms</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">printVoltage</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// read value from analog pin</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span><span class="n">voltagePin</span><span class="p">);</span>
  <span class="n">time_ms</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>

  <span class="c1">// Write the result</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">availableForWrite</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">outstr</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">time_ms</span><span class="p">,</span> <span class="n">DEC</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">String</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DEC</span><span class="p">));</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">outstr</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Set LEDs to off</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">redLEDPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">greenLEDPin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">redLEDPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">greenLEDPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>

  <span class="c1">// initialize serial communication</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// If we&#39;re auto-transferring data (streaming mode)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">daqMode</span> <span class="o">==</span> <span class="n">STREAM</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printVoltage</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">daqDelay</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Check if data has been sent to Arduino and respond accordingly</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Read in request</span>
    <span class="n">inByte</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>

    <span class="c1">// Handshake</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">HANDSHAKE</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">availableForWrite</span><span class="p">())</span> <span class="p">{</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Handshake message received.&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// If data is requested, fetch it and write it</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">VOLTAGE_REQUEST</span><span class="p">)</span> <span class="n">printVoltage</span><span class="p">();</span>

    <span class="c1">// Switch daqMode</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">ON_REQUEST</span><span class="p">)</span> <span class="n">daqMode</span> <span class="o">=</span> <span class="n">ON_REQUEST</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">STREAM</span><span class="p">)</span> <span class="n">daqMode</span> <span class="o">=</span> <span class="n">STREAM</span><span class="p">;</span>

    <span class="c1">// Read in DAQ delay</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">READ_DAQ_DELAY</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">;</span>
      <span class="n">daqDelayStr</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">readStringUntil</span><span class="p">(</span><span class="sc">&#39;x&#39;</span><span class="p">);</span>
      <span class="n">daqDelay</span> <span class="o">=</span> <span class="n">daqDelayStr</span><span class="p">.</span><span class="n">toInt</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// else, turn LEDs on or off</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">RED_LED_ON</span><span class="p">)</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">redLEDPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">RED_LED_OFF</span><span class="p">)</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">redLEDPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">GREEN_LED_ON</span><span class="p">)</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">greenLEDPin</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">inByte</span> <span class="o">==</span> <span class="n">GREEN_LED_OFF</span><span class="p">)</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">greenLEDPin</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The necessary Python code is in the code cell below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">find_arduino</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the name of the port that is connected to Arduino.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">list_ports</span><span class="o">.</span><span class="n">comports</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">manufacturer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;Arduino&quot;</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">manufacturer</span><span class="p">:</span>
                <span class="n">port</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">device</span>
    <span class="k">return</span> <span class="n">port</span>


<span class="k">def</span> <span class="nf">handshake_arduino</span><span class="p">(</span>
    <span class="n">arduino</span><span class="p">,</span> <span class="n">sleep_time</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">print_handshake_message</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handshake_code</span><span class="o">=</span><span class="mi">0</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make sure connection is established by sending</span>
<span class="sd">    and receiving bytes.&quot;&quot;&quot;</span>
    <span class="c1"># Close and reopen</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

    <span class="c1"># Chill out while everything gets set</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>

    <span class="c1"># Set a long timeout to complete handshake</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">arduino</span><span class="o">.</span><span class="n">timeout</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># Read and discard everything that may be in the input buffer</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">arduino</span><span class="o">.</span><span class="n">read_all</span><span class="p">()</span>

    <span class="c1"># Send request to Arduino</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">handshake_code</span><span class="p">]))</span>

    <span class="c1"># Read in what Arduino sent</span>
    <span class="n">handshake_message</span> <span class="o">=</span> <span class="n">arduino</span><span class="o">.</span><span class="n">read_until</span><span class="p">()</span>

    <span class="c1"># Send and receive request again</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">handshake_code</span><span class="p">]))</span>
    <span class="n">handshake_message</span> <span class="o">=</span> <span class="n">arduino</span><span class="o">.</span><span class="n">read_until</span><span class="p">()</span>

    <span class="c1"># Print the handshake message, if desired</span>
    <span class="k">if</span> <span class="n">print_handshake_message</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake message: &quot;</span> <span class="o">+</span> <span class="n">handshake_message</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="c1"># Reset the timeout</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

</pre></div>
</div>
</div>
<p>With these in hand, we can proceed to step up capability for controlling an external device and streaming data from it.</p>
</div>
<div class="section" id="Why-do-we-need-asynchrony?">
<h2>Why do we need asynchrony?<a class="headerlink" href="#Why-do-we-need-asynchrony?" title="Permalink to this headline">¶</a></h2>
<p>When you communicated with a device, there are plenty of other tasks you want the Python interpreter to be doing while it is acquiring data. At the very least, you may want it to be listening for more user input to <em>stop</em> acquiring data. But you may also want to perform calculations on the incoming data (such as digital filtering), control and/or receive data from other connected devices, or even just mess around in your Jupyter notebook.</p>
<p>In order to do these things, you want the data acquisition to happen asynchronously. You want the interpreter to occasionally read and parse data, but be free to do whatever else you want it to do when it is not reading and parsing data. That is, you do not want to tie up the interpreter all the time waiting for data to come in.</p>
</div>
<div class="section" id="Reading-data-in-chunks">
<h2>Reading data in chunks<a class="headerlink" href="#Reading-data-in-chunks" title="Permalink to this headline">¶</a></h2>
<p>As a first step toward asynchrony, we will write a function to read data in <strong>chunks</strong>. Instead of constantly monitoring the data coming in over the serial connection, we would rather occasionally check the serial connection to see if there are any data in the input buffer. If there is, we read in whatever is in the input buffer to clear it, go off and process that, and then wait a while before checking again. During that waiting time, you can have the interpreter do other tasks.</p>
<p><strong>Warning</strong>: Don’t wait too long to read, though! You do not want to overrun the USB input buffer size on your computer. Arduino’s output buffer is 64 bytes, and computers can have default input buffer sizes as low as 64 bytes as well. (I think most computers these days have input buffer sizes around 1024 bytes, but it does vary from machine to machine.)</p>
<div class="section" id="Chunk-reading-for-non-corrupted-data">
<h3>Chunk reading for non-corrupted data<a class="headerlink" href="#Chunk-reading-for-non-corrupted-data" title="Permalink to this headline">¶</a></h3>
<p>The function below reads in all of the data that is in the input buffer and returns the data as a byte string. We should specify a short timeout so that reading will stop before the buffer starts filling up again.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">read_all</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">read_buffer</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read all available bytes from the serial port</span>
<span class="sd">    and append to the read buffer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ser : serial.Serial() instance</span>
<span class="sd">        The device we are reading from.</span>
<span class="sd">    read_buffer : bytes, default b&#39;&#39;</span>
<span class="sd">        Previous read buffer that is appended to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output : bytes</span>
<span class="sd">        Bytes object that contains read_buffer + read.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    .. `**args` appears, but is never used. This is for</span>
<span class="sd">       compatibility with `read_all_newlines()` as a</span>
<span class="sd">       drop-in replacement for this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set timeout to None to make sure we read all bytes</span>
    <span class="n">previous_timeout</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">timeout</span>
    <span class="n">ser</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">in_waiting</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">in_waiting</span>
    <span class="n">read</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">in_waiting</span><span class="p">)</span>

    <span class="c1"># Reset to previous timeout</span>
    <span class="n">ser</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">previous_timeout</span>

    <span class="k">return</span> <span class="n">read_buffer</span> <span class="o">+</span> <span class="n">read</span>
</pre></div>
</div>
</div>
<p>For our present application, in which we read in comma-delimited time-voltage data, the byte string returned from this function might look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>b&#39;1032,541\r\n1052,542\r\n1073,554\r\n1093,5&#39;
</pre></div>
</div>
<p>Note that it does not end in a carriage return and newline. Those characters might not be in the read buffer yet, and since we are not using <code class="docutils literal notranslate"><span class="pre">read_until()</span></code>, we will not keep reading until we get those terminating characters. So, if we are parsing the output of this function, we should keep the last incomplete part of the data (in this case, <code class="docutils literal notranslate"><span class="pre">b'1093,5'</span></code> around for the next read.</p>
<p>Here is a parser that returns both the times and voltages as lists, as well as the remaining bytes that we will pass as the <code class="docutils literal notranslate"><span class="pre">read_buffer</span></code> kwarg in the <code class="docutils literal notranslate"><span class="pre">read_all()</span></code> function. There is some error checking. The only allowed characters are carriage returns, new lines, commas, and digits. Any message having other characters is discarded.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">parse_read</span><span class="p">(</span><span class="n">read</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse a read with time, voltage data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    read : byte string</span>
<span class="sd">        Byte string with comma delimited time/voltage</span>
<span class="sd">        measurements.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    time_ms : list of ints</span>
<span class="sd">        Time points in milliseconds.</span>
<span class="sd">    voltage : list of floats</span>
<span class="sd">        Voltages in volts.</span>
<span class="sd">    remaining_bytes : byte string</span>
<span class="sd">        Remaining, unparsed bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">time_ms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">voltage</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Separate independent time/voltage measurements</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;\d+|,&quot;</span><span class="p">)</span>
    <span class="n">raw_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">raw</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">read</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">raw_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">time_ms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">voltage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">1023</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">time_ms</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">time_ms</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="n">raw_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Chunk-reading-with-corrupted-data">
<h3>Chunk reading with corrupted data<a class="headerlink" href="#Chunk-reading-with-corrupted-data" title="Permalink to this headline">¶</a></h3>
<p>We discovered that on Windows machines, reads made with pySerial can sometimes result in corrupted bytes. This makes the read-in string unusable, and in many cases un-parsable because the resulting bytes do not correspond to any characters in ASCII. I am not sure exactly why this happens, but I suspect it is due to the read of a given byte being incomplete, with the read being interrupted before the stop bit. To counteract this, we can instead read chunks that <em>must</em> terminate in a newline using
<code class="docutils literal notranslate"><span class="pre">read_until()</span></code>. This blocks all other processes until the complete newline byte is read. This also ensures that all bytes preceding the newline are read in their entirety as well.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">read_all_newlines</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">read_buffer</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">n_reads</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read data in until encountering newlines.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ser : serial.Serial() instance</span>
<span class="sd">        The device we are reading from.</span>
<span class="sd">    n_reads : int</span>
<span class="sd">        The number of reads up to newlines</span>
<span class="sd">    read_buffer : bytes, default b&#39;&#39;</span>
<span class="sd">        Previous read buffer that is appended to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    output : bytes</span>
<span class="sd">        Bytes object that contains read_buffer + read.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    .. This is a drop-in replacement for read_all().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">read_buffer</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reads</span><span class="p">):</span>
        <span class="n">raw</span> <span class="o">+=</span> <span class="n">ser</span><span class="o">.</span><span class="n">read_until</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">raw</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="asyncio">
<h2>asyncio<a class="headerlink" href="#asyncio" title="Permalink to this headline">¶</a></h2>
<p>Python has handy built-in asynchronous capabilities using the <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> module from the standard library. It was introduced recently, in Python 3.5, and has had changes and deprecations since. The version in Python 3.8 has nice high-level functionality and has a stable API, so it is important that you are using Python 3.8.</p>
<p>I will give a brief overview of how it works here, but you would be well-served to <a class="reference external" href="https://docs.python.org/3/library/asyncio.html">read the documentation</a>, most importantly the <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html">coroutines and tasks section</a>.</p>
<p>At the center of asyncio’s high-level functionality are <strong>awaitables</strong>. An awaitable is a process that the interpreter can suspend such that it is not blocking the interpreter from doing other tasks. A very important awaitable is <code class="docutils literal notranslate"><span class="pre">asyncio.sleep()</span></code>, which is one we will put to use.</p>
<p>Aside from sleeping, the awaitables we will use are <strong>coroutines</strong> and <strong>tasks</strong>. You can think of a coroutine as a function that you can start and stop and start again. A task runs a coroutine. As usual, this is best seen by example.</p>
<p>We will start by making a coroutine that is a greeting in English. It says “hello” and then waits one second to say “world.” It returns a string describing what the message was. We would do this in a synchronous way (so it is a function and <em>not</em> a coroutine) like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">english</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;world&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;!&quot;</span> <span class="k">if</span> <span class="n">exclaim</span> <span class="k">else</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="s2">&quot;The message was a greeting to the world.&quot;</span>
</pre></div>
</div>
</div>
<p>We can run this function, and it works as expected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">message</span> <span class="o">=</span> <span class="n">english</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello,
world!
</pre></div></div>
</div>
<p>The problem is that the function, like all functions in Python, blocked. While waiting for a second to see “world,” the Python interpreter was busy (it was busy sleeping!). When a function of piece of code is running and prevents the interpreter from doing anything else, it is said to be <strong>blocking</strong>.</p>
<p>Now, let’s write an asynchronous version, that is a coroutine.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">english_async</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;world&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;!&quot;</span> <span class="k">if</span> <span class="n">exclaim</span> <span class="k">else</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>

    <span class="k">return</span> <span class="s2">&quot;The message was a greeting to the world.&quot;</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> keyword signifies that this is not a function, but a coroutine. That means the interpreter can start running the coroutine, leave it and do something else, and then run it again. It can only leave the coroutine where an awaitable is run. To run an awaitable within a coroutine, we use the <code class="docutils literal notranslate"><span class="pre">await</span></code> keyword. So, when we run <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">asyncio.sleep(1)</span></code>, the Python interpreter turns its attention away from the <code class="docutils literal notranslate"><span class="pre">english_async()</span></code> coroutine until <code class="docutils literal notranslate"><span class="pre">asyncio.sleep()</span></code> returns, which
will happen after one second.</p>
<p>We cannot just run a coroutine like it is a function. Look:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">english_async</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;coroutine object english_async at 0x7fa154b22c40&gt;
</pre></div></div>
</div>
<p>We get back a coroutine. To run it, we need a running <a class="reference external" href="https://en.wikipedia.org/wiki/Event_loop">event loop</a>. An event loop enables asynchronous computing by listening for requests to do something, and then dispatching resources to do the requested calculation. Each thread (which you can think of for our purposes as one core of your CPU) can have either zero or one event loops. If you are running a Jupyter notebook, there is an active event loop; that is how JupyterLab runs, waiting for you
to execute a cell. If you are not in a Jupyter notebook, you probably do not have an event loop running, so you need to start one. We will discuss how to start and run an event loop outside of JupyterLab <a class="reference external" href="#Running-without-an-existing-event-loop">later in this lesson</a>. For now, we will assume you have a running event loop, as you do in a Jupyter notebook.</p>
<p>To run the coroutine, you can create a task using <code class="docutils literal notranslate"><span class="pre">asyncio.create_task()</span></code>. Note that “calling” a coroutine like a function returns a coroutine, so the argument you pass into <code class="docutils literal notranslate"><span class="pre">asyncio.create_task()</span></code> is how you would call the coroutine, including all arguments and keyword arguments. Upon creation, the coroutine is run.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">english_async</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello,
world!
</pre></div></div>
</div>
<p>You can access the return value of the coroutine using the <code class="docutils literal notranslate"><span class="pre">result()</span></code> method of the task. Of course, you should first check the <code class="docutils literal notranslate"><span class="pre">done()</span></code> method of the task to see if it has completed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p>And we can safely retrieve the result.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;The message was a greeting to the world.&#39;
</pre></div></div>
</div>
<p>Now, let’s make another coroutine that says the same greeting in Spanish. For demonstration purposes, this function will only wait a half second between the two words.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">spanish_async</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;  ¡&quot;</span> <span class="k">if</span> <span class="n">exclaim</span> <span class="k">else</span> <span class="s2">&quot;  &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Hola, &quot;</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  mundo&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;!&quot;</span> <span class="k">if</span> <span class="n">exclaim</span> <span class="k">else</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="s2">&quot;El mensaje fue un saludo al mundo.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can run this coroutine as we did for the English one.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_spanish</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">spanish_async</span><span class="p">(</span><span class="n">exclaim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  ¡Hola,
  mundo!
</pre></div></div>
</div>
<p>With asynchronous computing, we can run the two coroutines <em>concurrently</em>! There are several ways to do this. First, we can create tasks one after another. The first task is created, “Hello,” is printed, and then the second task is created. (This time, we won’t exclaim.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">english_async</span><span class="p">())</span>
<span class="n">task_spanish</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">spanish_async</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello,
  Hola,
  mundo.
world.
</pre></div></div>
</div>
<p>Because the delay is shorter for the Spanish version, the entire message gets printed before the English message is complete.</p>
<p>As another option, we can gather the coroutines together using <code class="docutils literal notranslate"><span class="pre">asyncio.gather()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english_spanish</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">english_async</span><span class="p">(),</span> <span class="n">spanish_async</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello,
  Hola,
  mundo.
world.
</pre></div></div>
</div>
<p>To get the return values, we gain use <code class="docutils literal notranslate"><span class="pre">task_english_spanish.result()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english_spanish</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;The message was a greeting to the world.&#39;,
 &#39;El mensaje fue un saludo al mundo.&#39;]
</pre></div></div>
</div>
<p>Note that the result is the return values from the two coroutines as a list.</p>
<div class="section" id="Canceling-a-task">
<h3>Canceling a task<a class="headerlink" href="#Canceling-a-task" title="Permalink to this headline">¶</a></h3>
<p>Once a task is created, it may be interrupted and canceled using the <code class="docutils literal notranslate"><span class="pre">cancel()</span></code> method of the task. For example, we can cancel the English greeting before the second word comes out.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create the task</span>
<span class="n">task_english</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">english_async</span><span class="p">())</span>

<span class="c1"># Wait a half second</span>
<span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Cancel the task</span>
<span class="n">successfully_canceled</span> <span class="o">=</span> <span class="n">task_english</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Hello,
</pre></div></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">cancel()</span></code> method requests a cancellation, but cancellation is not guaranteed. You should read the asyncio documentation for more information.</p>
<p>A canceled job will both be marked as done and canceled.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english</span><span class="o">.</span><span class="n">done</span><span class="p">(),</span> <span class="n">task_english</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(True, True)
</pre></div></div>
</div>
<p>Since it was not allowed to return, though, the result will be a <code class="docutils literal notranslate"><span class="pre">CancelledError</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">task_english</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">CancelledError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-20-f5664860679d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>task_english<span class="ansi-blue-fg">.</span>result<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">CancelledError</span>:
</pre></div></div>
</div>
</div>
<div class="section" id="Running-without-an-existing-event-loop">
<h3>Running without an existing event loop<a class="headerlink" href="#Running-without-an-existing-event-loop" title="Permalink to this headline">¶</a></h3>
<p>If you do not have a running event loop on your thread, which will typically be the case if you are running outside of JupyterLab, you need to start an event loop. Fortunately, <code class="docutils literal notranslate"><span class="pre">asynchio</span></code> provides a convenient way to start (and automatically terminate upon completion of all coroutines) with its <code class="docutils literal notranslate"><span class="pre">asyncio.run()</span></code> function. To use it, define a coroutine that awaits all of the tasks you want to run and then pass that coroutine as an argument to <code class="docutils literal notranslate"><span class="pre">asyncio.run()</span></code>. For example, to run the English
and Spanish greetings concurrently, do the following.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">gathered</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">english_async</span><span class="p">(),</span> <span class="n">spanish_async</span><span class="p">())</span>
    <span class="k">await</span> <span class="n">gathered</span>

    <span class="k">return</span> <span class="n">gathered</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>


<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Receiving-data-asynchronously">
<h2>Receiving data asynchronously<a class="headerlink" href="#Receiving-data-asynchronously" title="Permalink to this headline">¶</a></h2>
<p>Now that we understand how asynchrony works in Python, let’s receive some data! We’ll of course start by shaking hands with Arduino.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">HANDSHAKE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">VOLTAGE_REQUEST</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RED_LED_ON</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">RED_LED_OFF</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">GREEN_LED_ON</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">GREEN_LED_OFF</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">ON_REQUEST</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">STREAM</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">READ_DAQ_DELAY</span> <span class="o">=</span> <span class="mi">8</span>

<span class="c1"># Windows users may need to give COM port for find_arduino()</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">find_arduino</span><span class="p">()</span>

<span class="c1"># Connect and handshake</span>
<span class="n">arduino</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span><span class="p">)</span>
<span class="n">handshake_arduino</span><span class="p">(</span><span class="n">arduino</span><span class="p">,</span> <span class="n">print_handshake_message</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Handshake message: Handshake message received.

</pre></div></div>
</div>
<p>Now we can write a coroutine to acquire data. A few comments on how it works.</p>
<ol class="arabic simple">
<li><p>We will read the data in chunks using the functions we wrote at the beginning of this lesson.</p></li>
<li><p>I read in the first few messages sent from Arduino after turning on the stream and discard them, just to ensure the input buffer of my computer is cleared and we’re getting good clean reads.</p></li>
<li><p>We sleep between acquisitions. I choose to sleep about 80% of the time of the acquisitions. This ensures that I will never have too many bytes in the input buffer, but I am still not checking as often as I could be. (Note that the <code class="docutils literal notranslate"><span class="pre">read_all_newlines()</span></code> function will take longer to run than the <code class="docutils literal notranslate"><span class="pre">read_all()</span></code> function because it has to wait until Arduino sends its final newline. It is blocking while it is waiting. This should not be a major slowdown, though.)</p></li>
<li><p>The function takes an input <code class="docutils literal notranslate"><span class="pre">reader</span></code>, which specifies which function we want to use to read in the serial data. By default, we use <code class="docutils literal notranslate"><span class="pre">read_all_newlines()</span></code> because it does not have the aforementioned issues on Windows.</p></li>
<li><p>I set up a dictionary to hold the data that gets updated with data as it is read.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set up data dictionary</span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">time_ms</span><span class="o">=</span><span class="p">[],</span> <span class="n">voltage</span><span class="o">=</span><span class="p">[])</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">daq_stream_async</span><span class="p">(</span>
    <span class="n">arduino</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">n_data</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">delay</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">n_trash_reads</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">n_reads_per_chunk</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">reader</span><span class="o">=</span><span class="n">read_all_newlines</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Obtain `n_data` data points from an Arduino stream</span>
<span class="sd">    with a delay of `delay` milliseconds between each.&quot;&quot;&quot;</span>
    <span class="c1"># Specify delay</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">READ_DAQ_DELAY</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="c1"># Turn on the stream</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">STREAM</span><span class="p">]))</span>

    <span class="c1"># Read and throw out first few reads</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_trash_reads</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">arduino</span><span class="o">.</span><span class="n">read_until</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Receive data</span>
    <span class="n">read_buffer</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_ms&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">n_data</span><span class="p">:</span>
        <span class="c1"># Read in chunk of data</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">reader</span><span class="p">(</span><span class="n">arduino</span><span class="p">,</span> <span class="n">read_buffer</span><span class="o">=</span><span class="n">read_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_reads</span><span class="o">=</span><span class="n">n_reads_per_chunk</span><span class="p">)</span>

        <span class="c1"># Parse it, passing if it is gibberish</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">read_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_read</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

            <span class="c1"># Update data dictionary</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_ms&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;voltage&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">V</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Sleep 80% of the time before we need to start reading chunks</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">n_reads_per_chunk</span> <span class="o">*</span> <span class="n">delay</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Turn off the stream</span>
    <span class="n">arduino</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytes</span><span class="p">([</span><span class="n">ON_REQUEST</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;time (ms)&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_ms&quot;</span><span class="p">][:</span><span class="n">n_data</span><span class="p">],</span> <span class="s2">&quot;voltage (V)&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;voltage&quot;</span><span class="p">][:</span><span class="n">n_data</span><span class="p">]}</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>To acquire data using this coroutine, we create a task.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">daq_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">daq_stream_async</span><span class="p">(</span><span class="n">arduino</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">n_data</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>We can retrieve the data frame from the task’s result and make a plot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get the data from from the result</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">daq_task</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="c1"># Convert milliseconds to seconds</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time (sec)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time (ms)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

<span class="c1"># Plot!</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
    <span class="n">x_axis_label</span><span class="o">=</span><span class="s1">&#39;time (s)&#39;</span><span class="p">,</span>
    <span class="n">y_axis_label</span><span class="o">=</span><span class="s1">&#39;voltage (V)&#39;</span><span class="p">,</span>
    <span class="n">frame_height</span><span class="o">=</span><span class="mi">175</span><span class="p">,</span>
    <span class="n">frame_width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">x_range</span><span class="o">=</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time (sec)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time (sec)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
<span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;time (sec)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;voltage (V)&#39;</span><span class="p">)</span>

<span class="n">bokeh</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="bk-root" id="f8686c5e-715b-4368-a965-7d4dc8505824" data-root-id="1003"></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function embed_document(root) {

  var docs_json = {"3fe3c44c-2eaf-4bc7-914e-30c3df5bfb60":{"defs":[],"roots":{"references":[{"attributes":{"below":[{"id":"1012"}],"center":[{"id":"1015"},{"id":"1019"}],"frame_height":175,"frame_width":500,"left":[{"id":"1016"}],"renderers":[{"id":"1038"}],"title":{"id":"1041"},"toolbar":{"id":"1027"},"x_range":{"id":"1004"},"x_scale":{"id":"1008"},"y_range":{"id":"1006"},"y_scale":{"id":"1010"}},"id":"1003","subtype":"Figure","type":"Plot"},{"attributes":{"data":{"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,690,691,692,693,694,695,696,697,698,699,700,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,750,751,752,753,754,755,756,757,758,759,760,761,762,763,764,765,766,767,768,769,770,771,772,773,774,775,776,777,778,779,780,781,782,783,784,785,786,787,788,789,790,791,792,793,794,795,796,797,798,799,800,801,802,803,804,805,806,807,808,809,810,811,812,813,814,815,816,817,818,819,820,821,822,823,824,825,826,827,828,829,830,831,832,833,834,835,836,837,838,839,840,841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857,858,859,860,861,862,863,864,865,866,867,868,869,870,871,872,873,874,875,876,877,878,879,880,881,882,883,884,885,886,887,888,889,890,891,892,893,894,895,896,897,898,899,900,901,902,903,904,905,906,907,908,909,910,911,912,913,914,915,916,917,918,919,920,921,922,923,924,925,926,927,928,929,930,931,932,933,934,935,936,937,938,939,940,941,942,943,944,945,946,947,948,949,950,951,952,953,954,955,956,957,958,959,960,961,962,963,964,965,966,967,968,969,970,971,972,973,974,975,976,977,978,979,980,981,982,983,984,985,986,987,988,989,990,991,992,993,994,995,996,997,998,999],"time (ms)":[3461,3481,3502,3522,3543,3563,3584,3604,3624,3645,3665,3686,3706,3727,3747,3768,3788,3809,3829,3850,3870,3891,3911,3932,3952,3973,3993,4014,4034,4055,4075,4096,4116,4136,4157,4177,4199,4219,4240,4260,4281,4301,4322,4342,4363,4383,4404,4424,4445,4465,4486,4506,4527,4547,4568,4588,4609,4629,4649,4670,4690,4711,4731,4752,4772,4793,4813,4834,4854,4875,4895,4916,4936,4957,4977,4998,5018,5039,5060,5081,5101,5122,5142,5163,5183,5203,5224,5244,5265,5285,5306,5326,5347,5367,5388,5408,5429,5449,5470,5490,5511,5531,5552,5572,5593,5613,5634,5654,5675,5695,5715,5736,5756,5777,5797,5818,5838,5859,5879,5900,5921,5942,5962,5983,6003,6024,6044,6065,6085,6106,6126,6147,6167,6188,6208,6228,6249,6269,6290,6310,6331,6351,6372,6392,6413,6433,6454,6474,6496,6516,6537,6557,6578,6598,6619,6639,6660,6680,6701,6721,6742,6762,6782,6803,6823,6844,6864,6885,6905,6926,6946,6967,6987,7008,7028,7049,7069,7090,7110,7131,7151,7173,7193,7214,7234,7255,7275,7296,7316,7336,7357,7377,7398,7418,7439,7459,7480,7500,7521,7541,7562,7582,7603,7623,7644,7664,7685,7705,7726,7746,7767,7787,7808,7828,7848,7869,7889,7910,7930,7951,7971,7992,8012,8034,8054,8075,8095,8116,8136,8157,8177,8198,8218,8239,8259,8280,8300,8321,8341,8361,8382,8402,8423,8443,8464,8484,8505,8525,8546,8566,8587,8607,8628,8648,8669,8689,8710,8730,8751,8771,8792,8812,8833,8853,8873,8895,8915,8936,8956,8977,8997,9018,9038,9059,9079,9100,9120,9141,9161,9182,9202,9223,9243,9264,9284,9305,9325,9346,9366,9387,9407,9427,9448,9468,9489,9509,9530,9550,9571,9591,9612,9632,9653,9673,9694,9714,9735,9756,9777,9797,9818,9838,9859,9879,9900,9920,9940,9961,9981,10002,10022,10043,10063,10084,10104,10125,10145,10166,10186,10207,10227,10249,10269,10290,10310,10331,10351,10372,10392,10413,10433,10454,10474,10494,10515,10535,10556,10577,10598,10618,10639,10659,10680,10700,10721,10741,10762,10782,10803,10823,10844,10864,10885,10906,10927,10947,10968,10988,11009,11029,11049,11070,11090,11111,11131,11152,11172,11193,11214,11235,11255,11276,11296,11317,11337,11358,11378,11399,11419,11440,11460,11481,11501,11522,11542,11563,11583,11603,11624,11644,11665,11685,11706,11726,11747,11767,11788,11808,11829,11849,11870,11890,11911,11931,11952,11972,11993,12013,12034,12054,12075,12095,12115,12136,12156,12177,12197,12218,12238,12259,12279,12300,12320,12342,12362,12383,12403,12424,12444,12465,12485,12506,12526,12547,12567,12588,12608,12628,12649,12670,12691,12711,12732,12752,12773,12793,12814,12834,12855,12875,12896,12916,12937,12957,12978,12999,13020,13040,13061,13081,13102,13122,13143,13163,13184,13204,13224,13245,13265,13286,13306,13328,13348,13369,13389,13410,13430,13451,13471,13492,13512,13533,13553,13574,13594,13615,13635,13657,13677,13698,13718,13739,13759,13779,13800,13820,13841,13861,13882,13902,13923,13943,13965,13985,14006,14026,14047,14067,14088,14108,14129,14149,14170,14190,14211,14231,14252,14272,14294,14314,14334,14355,14375,14396,14416,14437,14457,14478,14498,14519,14539,14560,14580,14601,14621,14643,14663,14684,14704,14725,14745,14766,14786,14807,14827,14848,14868,14888,14909,14929,14950,14970,14991,15011,15032,15052,15073,15093,15114,15134,15155,15175,15196,15216,15238,15258,15279,15299,15320,15340,15361,15381,15401,15422,15442,15463,15483,15503,15523,15544,15564,15585,15605,15626,15646,15667,15687,15708,15728,15749,15769,15790,15810,15831,15851,15872,15892,15912,15933,15953,15974,15994,16015,16035,16056,16076,16097,16117,16138,16158,16179,16200,16221,16241,16262,16282,16303,16323,16344,16364,16385,16405,16425,16446,16466,16487,16507,16528,16549,16570,16590,16611,16631,16652,16672,16693,16713,16734,16754,16775,16795,16816,16836,16857,16878,16899,16919,16940,16960,16980,17001,17021,17042,17062,17083,17103,17124,17144,17165,17186,17207,17227,17248,17268,17289,17309,17330,17350,17371,17391,17412,17432,17453,17473,17494,17515,17536,17556,17576,17597,17617,17638,17658,17679,17699,17720,17740,17761,17781,17802,17822,17844,17864,17885,17905,17926,17946,17967,17987,18008,18028,18049,18069,18089,18110,18130,18151,18172,18193,18213,18234,18254,18275,18295,18316,18336,18357,18377,18398,18418,18439,18459,18480,18501,18522,18542,18563,18583,18604,18624,18644,18665,18685,18706,18726,18747,18767,18788,18808,18830,18850,18871,18891,18912,18932,18953,18973,18994,19014,19035,19055,19076,19096,19117,19137,19159,19179,19200,19220,19240,19261,19281,19302,19322,19343,19363,19384,19404,19425,19445,19466,19487,19508,19528,19549,19569,19590,19610,19631,19651,19672,19692,19713,19733,19753,19774,19794,19816,19836,19857,19877,19898,19918,19939,19959,19980,20000,20021,20041,20062,20082,20103,20123,20145,20165,20186,20206,20227,20247,20268,20288,20308,20329,20349,20370,20390,20411,20431,20452,20473,20494,20514,20535,20555,20576,20596,20617,20637,20658,20678,20699,20719,20740,20760,20781,20802,20823,20843,20864,20884,20904,20925,20945,20966,20986,21007,21027,21048,21068,21089,21109,21131,21151,21172,21192,21213,21233,21254,21274,21295,21315,21336,21356,21377,21397,21417,21438,21459,21480,21500,21521,21541,21562,21582,21603,21623,21644,21664,21685,21705,21726,21746,21767,21788,21809,21829,21850,21870,21891,21911,21932,21952,21972,21993,22013,22035,22055,22076,22096,22117,22137,22158,22178,22199,22219,22240,22260,22281,22301,22323,22343,22364,22384,22405,22425,22446,22466,22487,22507,22528,22548,22568,22589,22609,22630,22651,22672,22692,22713,22733,22754,22774,22795,22815,22836,22856,22877,22897,22918,22938,22959,22980,23001,23021,23042,23062,23083,23103,23123,23144,23164,23185,23205,23226,23246,23267,23287,23309,23329,23350,23370,23391,23411,23432,23452,23473,23493,23514,23534,23555,23575,23596,23616,23638,23658,23678,23699,23719,23740,23760,23781,23801,23822,23842,23863,23883,23904,23924,23945,23966],"time (sec)":{"__ndarray__":"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","dtype":"float64","order":"little","shape":[1000]},"voltage (V)":{"__ndarray__":"RRVVVFFFBUBFFVVUUUUFQDvttNNOOwVARRVVVFFFBUA77bTTTjsFQDvttNNOOwVAO+200047BUBFFVVUUUUFQDvttNNOOwVARRVVVFFFBUA77bTTTjsFQDvttNNOOwVARRVVVFFFBUBFFVVUUUUFQEUVVVRRRQVARRVVVFFFBUA77bTTTjsFQDvttNNOOwVARRVVVFFFBUBFFVVUUUUFQEUVVVRRRQVARRVVVFFFBUBFFVVUUUUFQDvttNNOOwVAO+200047BUA77bTTTjsFQDvttNNOOwVARRVVVFFFBUA77bTTTjsFQEUVVVRRRQVARRVVVFFFBUBFFVVUUUUFQDvttNNOOwVAO+200047BUA77bTTTjsFQEUVVVRRRQVARRVVVFFFBUA77bTTTjsFQEUVVVRRRQVAO+200047BUA77bTTTjsFQEUVVVRRRQVAO+200047BUA77bTTTjsFQDvttNNOOwVAO+200047BUA77bTTTjsFQEUVVVRRRQVARRVVVFFFBUA77bTTTjsFQEUVVVRRRQVAO+200047BUBFFVVUUUUFQEUVVVRRRQVARRVVVFFFBUBFFVVUUUUFQDvttNNOOwVAO+200047BUBFFVVUUUUFQEUVVVRRRQVARRVVVFFFBUA77bTTTjsFQDHFFFNMMQVAO+200047BUBFFVVUUUUFQEUVVVRRRQVAWWWVVVZZBUBjjTXWWGMFQGONNdZYYwVAbbXVVlttBUB33XXXXXcFQIsttthiiwVAlVVWWWWVBUCfffbZZ58FQL311ltvvQVAVE455ZRTBkD+9ttvv/0GQHbXXXfddQdAvO++++67B0Dkjz/++OMHQO6333777QdAFlhggQUWCEBmmGGGGWYIQIQQQgghhAhAjjjiiCOOCECEEEIIIYQIQHDAAQcccAhAUkghhRRSCEA00EADDTQIQCqooIIKKghAIIAAAgggCEAggAACCCAIQCqooIIKKghAKqigggoqCEAqqKCCCioIQCqooIIKKghAIIAAAgggCEAggAACCCAIQCqooIIKKghANNBAAw00CEA00EADDTQIQDTQQAMNNAhAPvjggw8+CEBIIIEEEkgIQFxwwQUXXAhAeuihhx56CEB66KGHHnoIQJhgggkmmAhAtthiiy22CEAaaaSRRhoJQH755ZdffglAsMEGG2ywCUBvuummm24KQPvqq6+++gpAaaONNtpoC0DNM88888wLQB100EEHHQxAbbTRRhttDED55JNPPvkMQF111VVXXQ1A880333zzDUB21llnnXUOQPjee++99w5Aeuedd955D0Ded999990PQCaYYIIJJhBAmWSSSSaZEEAllVRSSSURQNlll1122RFAcL755ptvEkCsrrrqqqsSQMomm2yyyRJA2WKLLbbYEkDtsssuu+wSQBVTTDHFFBNAYH/99ddfE0Crq6666qoTQOyvv/766xNAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFECNM84444wTQAsrrLDCChNAf/rpp59+EkD33XffffcRQLvttttuuxFAmGGGGWaYEUCJJZZYYokRQHDBBRdccBFATTXVVFNNEUAvvfTSSy8RQBZZZJFFFhFA+OCDDz74EEDaaKONNtoQQMsss8wyyxBAqKCCCiqoEEBnnHHGGWcQQDXUUEMNNRBA6J9//vnnD0CYX3755ZcPQFxvvfXWWw9AIH/88ccfD0DkjjvuuOMOQMYWW2yxxQ5AgP75559/DkBEDjnkkEMOQAgeeOCBBw5AwQUXXHDBDUCZZZZZZpkNQHHFFVdccQ1ANdVUU001DUDvvPPOO+8MQL300ksvvQxAgQQSSCCBDEAnnHDCCScMQOurr7766gtAr7vuuuuuC0B9880333wLQFVTTTXVVAtAI4ssssgiC0DxwgsvvPAKQJdaaqmllgpAKaKIIoooCkDYYYcddtgJQJJJJplkkglATDHFFFNMCUDyyCOPPPIIQGaYYYYZZghA0D///PPPB0Acb7zxxhsHQF522WWXXQZAd9111113BUBppJFGGmkEQKurrrrqqgNACyussMIKA0CxwgorrLACQGGCCSaYYAJAG2qooYYaAkDKKaeccsoBQHDBBRdccAFAKqmkkkoqAUDkkEMOOeQAQHbYYYcddgBACCCAAAIIAEAgf/zxxx//P1heeeWVV/4/33333Xff/T+33Xbbbbf9P8stt9xyy/0/CB544IEH/j8gf/zxxx//P1hggQUWWABAa6qppppqAkBvu+22224DQMkjjzzyyANAv/vuu+++A0DJI4888sgDQMkjjzzyyANAoYMOOuigA0Afe+yxxx4DQJ1yyimnnAJAeumll156AUAccMABBxwAQID++eeff/4/e+211157/T/HHHPMMcf8P1977bXXXvs/tthiiy22+D9ttdVWW231P1FDDTXUUPM/6KGHHnro8T9IIYUUUkjxP0ghhRRSSPE/SCGFFFJI8T8lkkgiiSTyP+2yyy677PI/ZZNNNtlk8z/xww8//PDzPy200EILLfQ/zTTTTDPN9D9FFVVUUUX1Pw422GCDDfY/EkccccQR9z+ed9555533PwIIIIAAAvg/UkghhRRS+D+66aabbrr5P6+77rrrrvs/e+211157/T8IIIAAAggAQGKIIYYYYgBAiiiiiCKKAECUUEIJJZQAQKigggoqqABAvPDCCy+8AED44IMPPvgAQIQRRhhhhAFAEUIIIYQQAkDjiiuuuOICQN1zzz333ANAzTTTTDPNBECzzTbbbLMFQFROOeWUUwZAmmaaaaaZBkDWVltttdUGQDC//PLLLwdAYocddthhB0Ced955550HQGaYYYYZZghAEEEEEUQQCUBggQUWWGAJQGqppZZaaglATDHFFFNMCUAQQQQRRBAJQMAAAwwwwAhAeuihhx56CEAqqKCCCioIQAIIIIAAAghAxhdffPHFB0BEDz300EMHQO+999577wVAQQQRRBBBBECTSiqppJICQFxxxRVXXAFAWGCBBRZYAECsr7766qv/PzTPPPPMM/8/qJ566qmn/j8wvvjiiy/+PxxuuOGGG/4/ML744osv/j+A/vnnn3/+P6ieeuqpp/4/0D777LPP/j/QPvvss8/+P7zuuuuuu/4/vO666667/j/QPvvss8/+P7zuuuuuu/4/0D777LPP/j/QPvvss8/+P9A+++yzz/4/0D777LPP/j/QPvvss8/+P9A+++yzz/4/5I477rjj/j/kjjvuuOP+P9A+++yzz/4/0D777LPP/j/kjjvuuOP+P9A+++yzz/4/0D777LPP/j/kjjvuuOP+P9A+++yzz/4/5I477rjj/j/kjjvuuOP+P+SOO+644/4/+N577733/j/kjjvuuOP+P+SOO+644/4/+N577733/j8ML7zwwgv/PyB//PHHH/8/NM8888wz/z8gf/zxxx//PzTPPPPMM/8/IH/88ccf/z8ML7zwwgv/P/jee++99/4/qJ566qmn/j/LLbfccsv9PzvssMMOO/w/++qrr776+j/iiSeeeOL5P95444033vg/jjjiiCOO+D8++OCDDz74P9pnn3322fc/Yocddthh9z+GFlpooYX2P+WVV1555fU/RRVVVFFF9T999NFHH330P6GDDjrooPM/scIKK6yw8j/AAQcccMDxP/jggw8++PA/bLDBBhts8D8IIIAAAgjwP5hffvnll+8/0D777LPP7j/ffffdd9/tP8ccc8wxx+w/11tvvfXW6z+/+uqrr77qP/bZZ5999uk/3njjjTfe6D8WWGCBBRboP9ZWW2211eY/vfXWW2+95T/11FNPPfXkPy200EILLeQ/jTPOOOOM4z8VU0wxxRTjP3XSSSeddOI/1FFHHXXU4T+UUEIJJZTgP+iff/75598/+N5777333j9nnXXWWWfdP4cbbrjhhts/VllllVVW2T8ml1xyySXXP6WUUkoppdQ/hBFGGGGE0T9nnXXWWWfNP6aZZppppsk/5ZVXXnnlxT8lkkgiiSTCP0caaaSRRro/hBFGGGGEsT8IHnjggQeePwUUUEABBYQ/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQQQQQRRLA/BRRQQAEFxD9mmGGGGWbIP0caaaSRRso/55prrrnmyj9nnXXWWWfNPzTRRBNNNNE/hhZaaKGF1j+HG2644YbbP/jee++9994/RBBBBBFE4D+88MILL7zgP+SQQw455OA/NNFEE0004T+sscYaa6zhP51yyimnnOI/VVRRRRVV5D8dddRRRx3lP+WVV1555eU/rrbaaqut5j/ut99+++3nP7bYYosttug/fvnll19+6T+XWmqppZbqP0888cQTT+w/77zzzjvv7D/ffffdd9/tP+iff/755+8/bLDBBhts8D800UQTTTTxP2GCCSaYYPI/KaOMMsoo8z/JI4888sjzP2mkkUYaafQ/pZRSSiml9D9FFVVUUUX1P6622mqrrfY/oogiiiii+D/OOeecc875P2+66aabbvo/X3vttdde+z+ffPLJJ5/8P7zuuuuuu/4/2mijjTbaAED88ccff/wBQIkiiiiiiAJAscIKK6ywAkCxwgorrLACQLHCCiussAJAp5pqqqmmAkBrqqmmmmoCQBFCCCGEEAJAttlmm222AUBIIYUUUkgBQJ544oknngBAwP/++++//z+33Xbbbbf9P+urr7766vs/RxpppJFG+j9qqaWWWmr5P4444ogjjvg/nnfeeeed9z821lhjjTX2P+GEE0444fQ/ySOPPPLI8z+JIooooojyP8ABBxxwwPE/NNFEE0008T8IIIAAAgjwP5988sknn+w/pplmmmmm6T+22GKLLbboP7bYYosttug/Lrnkkksu6T8nnHDCCSfsPwgeeOCBB+4/gAACCCCA8D9lk0022WTzP+GEE0444fQ/IoYYYogh9j/qpptuuun2PzrnnHPOOfc/dtddd9119z9mmGGGGWb4P7rppptuuvk/I4ssssgi+z8//fTTTz/9PzTPPPPMM/8/YoghhhhiAEDkkEMOOeQAQAwxxBBDDAFAKqmkkkoqAUBwwQUXXHABQMopp5xyygFATTLJJJNMAkCdcsopp5wCQPfaa6+99gJAAQMMMMAAA0D32muvvfYCQM8666yzzgJAddJJJ510AkARQgghhBACQKKJJppoogFAssgiiyyyAECYX3755Zf/P4899thjj/0/E0wwwQQT/D9vuummm276PwIIIIAAAvg/CSWUUEIJ9T+JIooooojyPwwxxBBDDPE/HHDAAQcc8D9IH3300UfvP3fccccdd+w/fvnll19+6T9ON910003nPzbWWGONNeY/9dRTTz315D9VVFFFFVXkPz3zzDPPPOM/hBFGGGGE4T9ssMEGG2zgPwgeeOCBB94/N9tss8022z8GGWSQQQbZP9ZWW2211dY/FVNMMcUU0z9EEEEEEUTQP2edddZZZ80/xxxzzDHHzD+HG2644YbLP0caaaSRRso/RxpppJFGyj9HGmmkkUbKP0caaaSRRso/xxxzzDHHzD9IH3300UfPP+iff/75588/RBBBBBFE0D9EEEEEEUTQP5RQQgkllNA/lFBCCSWU0D+UUEIJJZTQP+SQQw455NA/5JBDDjnk0D/kkEMOOeTQPzTRRBNNNNE/5JBDDjnk0D+UUEIJJZTQP0QQQQQRRNA/CB544IEHzj/HHHPMMcfMPyeccMIJJ8w/BhlkkEEGyT+EEUYYYYTBP8USSyyxxLI/CB544IEHjj8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACB544IEHrj9FFVVUUUXFPyWSSCKJJNI/dtddd9111z8XXXTRRRfdP6yxxhprrOE/FVNMMcUU4z999NFHH33kP2211VZbbeU/XnbZZZdd5j8WWGCBBRboP84555xzzuk/d9xxxx137D+onnrqqafuP/jggw8++PA/2WKLLbbY8j9ppJFGGmn0P4EFFlhggfU/XnbZZZdd9j8SRxxxxBH3PxZYYIEFFvg/9tlnn332+T933HHHHXf8P+SOO+644/4/bLDBBhtsAEA++eSTTz4BQNRRRx111AFAa6qppppqAkABAwwwwAADQG+77bbbbgNAl1tuueWWA0Chgw466KADQKGDDjrooANAjTPOOOOMA0Bba6211loDQDPLLLPMMgNAM8sss8wyA0Apo4wyyigDQDPLLLPMMgNAM8sss8wyA0Apo4wyyigDQDPLLLPMMgNAKaOMMsooA0Apo4wyyigDQCmjjDLKKANAKaOMMsooA0A988wzzzwDQDPLLLPMMgNAM8sss8wyA0A988wzzzwDQEcbbbTRRgNAZZNNNtlkA0CDCy644IIDQJdbbrnllgNAtdNOO+20A0Dxww8//PADQF988cUXXwRAkUQSSSSRBEDNNNNMM80EQEUVVVRRRQVAiy222GKLBUAihhhiiCEGQK622mqrrQZACB988MEHB0BEDz300EMHQMYXX3zxxQdAFlhggQUWCEBmmGGGGWYIQBBBBBFEEAlAuummm266CUAzyiijjDIKQPvqq6+++gpAr7vuuuuuC0BFFFFEEUUMQNFEE0000QxAZ5111llnDUDVVVddddUNQGyuueaaaw5AAgcccMABD0Csr7766qsPQDDAAAMMMBBAnnjiiSeeEEBDDTXUUEMRQPLJJ5988hFAeuaZZ555EkC76qqrrroSQMD++uuvvxJAscIKK6ywEkCJIooooogSQFxuueWWWxJANM4444wzEkAHGmiggQYSQKKJJppoohFAL7300ksvEUCUUEIJJZQQQNRPP/300w9AgP75559/DkCjjTbaaKMNQNtss8022wxAHXTQQQcdDEBpo4022mgLQJdaaqmllgpAJJFEEkkkCUDGF1988cUHQLjeeuuttwZA+eWXX375BUAxxRRTTDEFQJtssskmmwRABRRQQAEFBEA988wzzzwDQE0yySSTTAJA0EADDTTQAECzzDLLLLP8P7LHHnvssfc/RRVVVFFF9T+55JJLLrn0P6WUUkoppfQ/pZRSSiml9D+llFJKKaX0P+GEE0444fQ/bbXVVltt9T821lhjjTX2P+qmm2666fY/iieeeOKJ9z/aZ5999tn3P6KIIoooovg/CyqooIIK+j/76quvvvr6PxNMMMEEE/w/s8wyyyyz/D/vvPPOO+/8P3vttddee/0/880333zz/T9EDjnkkEP+P2yuueaaa/4/gP75559//j8ML7zwwgv/PwgggAACCABAqKCCCiqoAECEEUYYYYQBQCWSSCKJJAJAa6qppppqAkCJIooooogCQLHCCiussAJAb7vttttuA0CHHHLIIYcEQIsttthiiwVAHG+88cYbB0CssMIKK6wIQH755ZdffglAxBFHHHHECUDOOeecc84JQMQRRxxxxAlAdNFFF110CUAaaaSRRhoJQKKIIooooghA7rfffvvtB0DMLrvssssGQKmlllpqqQVAr7zyyiuvBEDTSy+99NIDQCmjjDLKKANAp5pqqqmmAkDKKaeccsoBQIoooogiigBARA455JBD/j/rq6+++ur7P+KJJ5544vk/oogiiiii+D/aZ5999tn3PzrnnHPOOfc/hhZaaKGF9j8ihhhiiCH2P6mlllpqqfU/McUUU0wx9T/NNNNMM830P2mkkUYaafQ/GWSQQQYZ9D8FFFBAAQX0P/HDDz/88PM/LbTQQgst9D+RRBJJJJH0P0UVVVRRRfU/DjbYYIMN9j9KJplkkkn2P4YWWmihhfY/1lZbbbXV9j9SSCGFFFL4P9NKK6200vo/xxxzzDHH/D9EDjnkkEP+P/jee++99/4/NM8888wz/z+EDz744IP/PxJIIIEEEgBA7rjjjjvuAEBNMskkk0wCQKWUUkoppQRAsscee+yxB0CcccYZZ5wJQPvqq6+++gpAQQMNNNBAC0BVU0011VQLQF977bXXXgtAaaONNtpoC0CHG2644YYLQK+77rrrrgtAzTPPPPPMC0DDCy+88MILQLnjjjvuuAtAkUMOOeSQC0A322yzzTYLQNNKK6200gpAPfLII488CkCEEEIIIYQIQLjeeuuttwZACSWUUEIJBUChgw466KADQEcbbbTRRgNARxtttNFGA0BHG2200UYDQKurrrrqqgNA++uvv/76A0BffPHFF18EQP/8888//wRAs80222yzBUCkjjrqqKMGQLLHHnvssQdAwAADDDDACEApoogiiigKQH3zzTfffAtA5ZRTTjnlDED99ddff/0NQDC++OKLLw5AOuaYY445DkA65phjjjkOQDC++OKLLw5AJpZYYoklDkAIHnjggQcOQP31119//Q1A/fXXX3/9DUD99ddff/0NQP31119//Q1A/fXXX3/9DUD99ddff/0NQP31119//Q1A880333zzDUDppZdeeukNQOmll1566Q1A6aWXXnrpDUDzzTfffPMNQP31119//Q1AHG644YYbDkBYXnnllVcOQMYWW2yxxQ5ANM8888wzD0DA//77778PQAgggAACCBBASSSRRBJJEECUUEIJJZQQQPPMM8888xBAa6211lprEUC77bbbbrsRQN5555133hFAEUIIIYQQEkBDCimkkEISQH/66aeffhJAzzrrrLPOEkDtsssuu+wSQAYXXHDBBRNAH3vsscceE0BHG2200UYTQFtrrbXWWhNAeeONN954E0Cml1566aUTQNhff/311xNA7K+//vrrE0D766+//voTQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEAAAAAAAAAUQAAAAAAAABRAAAAAAAAAFEDxww8//PATQLrnnnvuuRNAeeONN954E0AkjzzyyCMTQNliiy222BJAjjbaaKONEkBSRhlllFESQBFCCCGEEBJA44033njjEUDKKaeccsoRQLbZZpttthFAnXXWWWedEUBcccUVV1wRQC+99NJLLxFA+OCDDz74EEDQQAMNNNAQQKigggoqqBBAdthhhx12EEAwwAADDDAQQMonn3zyyQ9AUkcdddRRD0D43nvvvfcOQNA+++yzzw5ATjbZZJNNDkDffffdd98NQMstt9xyyw1Ayy233HLLDUAmllhiiSUOQCaWWGKJJQ5AHG644YYbDkAcbrjhhhsOQBxuuOGGGw5AOuaYY445DkA65phjjjkOQDrmmGOOOQ5AOuaYY445DkA65phjjjkOQDrmmGOOOQ5AOuaYY445DkBEDjnkkEMOQDrmmGOOOQ5AOuaYY445DkA65phjjjkOQDrmmGOOOQ5AML744osvDkAwvvjiiy8OQDC++OKLLw5AML744osvDkAwvvjiiy8OQDrmmGOOOQ5AML744osvDkA65phjjjkOQDC++OKLLw5AJpZYYoklDkAcbrjhhhsOQBxuuOGGGw5AHG644YYbDkAcbrjhhhsOQBxuuOGGGw5AHG644YYbDkAmllhiiSUOQBxuuOGGGw5AJpZYYoklDkASRhhhhBEOQAgeeOCBBw5A6aWXXnrpDUC33XbbbbcNQI899thjjw1AAw000EADDUCVVFJJJZUMQE888cQTTwxA9dNPP/30C0CRQw455JALQC2zzDLLLAtA00orrbTSCkBvuummm24KQD3yyCOPPApAFVJIIYUUCkDYYYcddtgJQKaZZppppglAaqmlllpqCUAkkUQSSSQJQN5444033ghAoogiiiiiCEBccMEFF1wIQO6333777QdAnnfeeeedB0BON910000HQOqmm2666QZAuN566623BkA=","dtype":"float64","order":"little","shape":[1000]}},"selected":{"id":"1050"},"selection_policy":{"id":"1049"}},"id":"1034","type":"ColumnDataSource"},{"attributes":{"axis_label":"time (s)","formatter":{"id":"1043"},"major_label_policy":{"id":"1042"},"ticker":{"id":"1013"}},"id":"1012","type":"LinearAxis"},{"attributes":{},"id":"1013","type":"BasicTicker"},{"attributes":{},"id":"1043","type":"BasicTickFormatter"},{"attributes":{},"id":"1041","type":"Title"},{"attributes":{"axis":{"id":"1012"},"ticker":null},"id":"1015","type":"Grid"},{"attributes":{},"id":"1042","type":"AllLabels"},{"attributes":{"end":23.966,"start":3.461},"id":"1004","type":"Range1d"},{"attributes":{},"id":"1017","type":"BasicTicker"},{"attributes":{"axis":{"id":"1016"},"dimension":1,"ticker":null},"id":"1019","type":"Grid"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"right_units":"screen","syncable":false,"top_units":"screen"},"id":"1026","type":"BoxAnnotation"},{"attributes":{},"id":"1045","type":"AllLabels"},{"attributes":{"axis_label":"voltage (V)","formatter":{"id":"1046"},"major_label_policy":{"id":"1045"},"ticker":{"id":"1017"}},"id":"1016","type":"LinearAxis"},{"attributes":{},"id":"1046","type":"BasicTickFormatter"},{"attributes":{},"id":"1006","type":"DataRange1d"},{"attributes":{"data_source":{"id":"1034"},"glyph":{"id":"1036"},"hover_glyph":null,"muted_glyph":null,"nonselection_glyph":{"id":"1037"},"view":{"id":"1039"}},"id":"1038","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1034"}},"id":"1039","type":"CDSView"},{"attributes":{},"id":"1010","type":"LinearScale"},{"attributes":{},"id":"1025","type":"HelpTool"},{"attributes":{},"id":"1021","type":"WheelZoomTool"},{"attributes":{"line_color":"#1f77b4","x":{"field":"time (sec)"},"y":{"field":"voltage (V)"}},"id":"1036","type":"Line"},{"attributes":{"active_multi":null,"tools":[{"id":"1020"},{"id":"1021"},{"id":"1022"},{"id":"1023"},{"id":"1024"},{"id":"1025"}]},"id":"1027","type":"Toolbar"},{"attributes":{},"id":"1008","type":"LinearScale"},{"attributes":{},"id":"1020","type":"PanTool"},{"attributes":{"line_alpha":0.1,"line_color":"#1f77b4","x":{"field":"time (sec)"},"y":{"field":"voltage (V)"}},"id":"1037","type":"Line"},{"attributes":{},"id":"1049","type":"UnionRenderers"},{"attributes":{"overlay":{"id":"1026"}},"id":"1022","type":"BoxZoomTool"},{"attributes":{},"id":"1023","type":"SaveTool"},{"attributes":{},"id":"1024","type":"ResetTool"},{"attributes":{},"id":"1050","type":"Selection"}],"root_ids":["1003"]},"title":"Bokeh Application","version":"2.3.2"}};
  var render_items = [{"docid":"3fe3c44c-2eaf-4bc7-914e-30c3df5bfb60","root_ids":["1003"],"roots":{"1003":"f8686c5e-715b-4368-a965-7d4dc8505824"}}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);

  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);
</script></div>
</div>
</div>
<div class="section" id="App-with-live-updates">
<h2>App with live updates<a class="headerlink" href="#App-with-live-updates" title="Permalink to this headline">¶</a></h2>
<p>While the above approach is useful, it leaves a bit to be desired, since we are not updating the plot in real time. Only after data acquisition is finished can we make a plot. We would rather have the plot update in real time, together with a button to start and stop data acquisition. In order to do that, we need to connect a Bokeh plot to a <strong>periodic callback</strong>, which constantly checks the dictionary of acquired data and updates the plot accordingly.</p>
<p>As an example of how a Bokeh app can use a periodic callback for streaming, I build one below to dynamically plot a random walk. The walk will proceed with a dot doing the walk and the trail behind it represented as a line. To build a Bokeh app, we need to write a function the controls the app. The function for the random walker is shown below with an explanation following immediately.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">random_walk</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Bokeh app for a dynamic random walk of 1000 steps.&quot;&quot;&quot;</span>
    <span class="n">rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">3252</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
        <span class="n">frame_width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">frame_height</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">x_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
        <span class="n">y_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Use ColumnDataSources for data for populating glyphs</span>
    <span class="n">source_line</span> <span class="o">=</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ColumnDataSource</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
    <span class="n">source_dot</span> <span class="o">=</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ColumnDataSource</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source_line</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">dot</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source_dot</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tomato&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

    <span class="nd">@bokeh</span><span class="o">.</span><span class="n">driving</span><span class="o">.</span><span class="n">linear</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">remove_periodic_callback</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">new_position</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source_dot</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">source_dot</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
            <span class="p">}</span>
            <span class="n">source_line</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">new_position</span><span class="p">)</span>
            <span class="n">source_dot</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">new_position</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">add_root</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># Add a periodic callback to be run every 20 milliseconds</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">add_periodic_callback</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The argument of the function (traditionally called <code class="docutils literal notranslate"><span class="pre">doc</span></code>) is accessed to add any plots (or other Bokeh) to app and to add the callbacks. We first set up the figure and set up the data sources for the dot and for the line. Next, we set up the data sources using Bokeh’s <code class="docutils literal notranslate"><span class="pre">ColumnDataSource</span></code>. So far in the bootcamp, we have use Pandas data frames as the source for plots. Under the hood, Bokeh automatically converts those to its <code class="docutils literal notranslate"><span class="pre">ColumnDataSource</span></code> data type. This data type may be dynamically
updated in a Bokeh app, which is exactly what we want. After the data sources are set up, we set up an update function (we call it <code class="docutils literal notranslate"><span class="pre">update()</span></code> here, but it could have any name). This is what will be called each time the periodic callback triggers. In this case, we decorate the function with <code class="docutils literal notranslate"><span class="pre">&#64;bokeh.driving.linear()</span></code>. This results in the argument of <code class="docutils literal notranslate"><span class="pre">update</span></code>, <code class="docutils literal notranslate"><span class="pre">step</span></code>, being advanced by one every time the function is called. This way we can keep track of how many steps were taken. In the
update function, if we have exceeded the number of desired steps, we cancel the periodic callbacks. Otherwise, we compute the next step of the random walk by computing a random angle for the step. We update the position of the walker by adding the step to it. Finally, we update the data sources for the dot and line. For the line, we use the <code class="docutils literal notranslate"><span class="pre">stream()</span></code> method. This results in Bokeh only appending new data to the data source instead of pushing through the whole data set for the plot each time.
For the dot, since it is only plotted as a single position, we update the source data to be the dot position.</p>
<p>To run our app, we use <code class="docutils literal notranslate"><span class="pre">bokeh.io.show()</span></code>. We should also include the URL of the notebook (specified above in the input cell; you can see the URL by looking at the top of your browser).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bokeh</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">random_walk</span><span class="p">,</span> <span class="n">notebook_url</span><span class="o">=</span><span class="n">notebook_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<script id="1106">
  var xhr = new XMLHttpRequest()
  xhr.responseType = 'blob';
  xhr.open('GET', "http://localhost:55962/autoload.js?bokeh-autoload-element=1106&bokeh-absolute-url=http://localhost:55962&resources=none", true);

  xhr.onload = function (event) {
    var script = document.createElement('script'),
    src = URL.createObjectURL(event.target.response);
    script.src = src;
    document.body.appendChild(script);
  };
xhr.send();
</script></div>
</div>
<p>We can use this technique to build an app for acquiring voltages coming out of the potentiometer. Our strategy for building our app is this:</p>
<ul class="simple">
<li><p>Set up a dictionary containing lists of data</p></li>
<li><p>Asynchronously collect data from Arduino that updates the data dictionary</p></li>
<li><p>Set up a periodic callback so Bokeh updates the plot from the data dictionary</p></li>
</ul>
<p>To do this, we need to keep track of which data are included on the plot and which are new. Therefore, the data dictionary also contains a variable to remember how long the time point and voltage lists were the last time the plot was rendered.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set up data dictionary</span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prev_array_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time_ms</span><span class="o">=</span><span class="p">[],</span> <span class="n">voltage</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
</div>
<p>Next, we build the plotting app. Because the app must have a call signature <code class="docutils literal notranslate"><span class="pre">app(doc)</span></code>, I like to write a function that returns an app. This allows me to have a more convenient API for specifying properties of the app. This app is essentially like the random walk app, except that we pull data out of the data dictionary as needed. We also have a <strong>rollover</strong> parameter, which specifies the maximum number of data points to be displayed on the plot. Only the most recent data points are displayed.
For time series data, like we’re plotting here, this results in a “scroll” across the plot, kind of like a stock ticker.</p>
<p>I have also included a keyword argument for the delay between plot updates. If the delay is too short, your computer will struggle trying to render the Bokeh plot at a high rate. In my experience, plots that are updated every 100 ms or less look like essentially continuous updates to the eye, so I use a plot delay of 90 ms.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">potentiometer_app</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_data</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">rollover</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">plot_update_delay</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a function defining a Bokeh app for streaming</span>
<span class="sd">    data up to `n_data` data points. A maximum of `rollover`</span>
<span class="sd">    data points are shown at a time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_app</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
        <span class="c1"># Instatiate figures</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
            <span class="n">frame_width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">frame_height</span><span class="o">=</span><span class="mi">175</span><span class="p">,</span>
            <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span>
            <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;voltage (V)&quot;</span><span class="p">,</span>
            <span class="n">y_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># No padding on x_range makes data flush with end of plot</span>
        <span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Start with an empty column data source with time and voltage</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">bokeh</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ColumnDataSource</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="p">[]})</span>

        <span class="c1"># Put a line glyph</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;V&quot;</span><span class="p">)</span>

        <span class="nd">@bokeh</span><span class="o">.</span><span class="n">driving</span><span class="o">.</span><span class="n">linear</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
            <span class="c1"># Shut off periodic callback if we have plotted all of the data</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">n_data</span><span class="p">:</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">remove_periodic_callback</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Update plot by streaming in data</span>
                <span class="n">source</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_ms&#39;</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;prev_array_length&#39;</span><span class="p">]:])</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                        <span class="s2">&quot;V&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;voltage&#39;</span><span class="p">][</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;prev_array_length&#39;</span><span class="p">]:],</span>
                    <span class="p">},</span>
                    <span class="n">rollover</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;prev_array_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_ms&#39;</span><span class="p">])</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">add_root</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">add_periodic_callback</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">plot_update_delay</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">_app</span>
</pre></div>
</div>
</div>
<p>Now, to put the app to use! We need to show the app, and then create a task to acquire the data. The plot is then updated live! (Note that this is not viewable in the static HTML version of this lesson.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n_data</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">bokeh</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">potentiometer_app</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_data</span><span class="o">=</span><span class="n">n_data</span><span class="p">),</span> <span class="n">notebook_url</span><span class="o">=</span><span class="n">notebook_url</span><span class="p">)</span>
<span class="n">daq_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">daq_stream_async</span><span class="p">(</span><span class="n">arduino</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">n_data</span><span class="o">=</span><span class="n">n_data</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<script id="3196">
  var xhr = new XMLHttpRequest()
  xhr.responseType = 'blob';
  xhr.open('GET', "http://localhost:55967/autoload.js?bokeh-autoload-element=3196&bokeh-absolute-url=http://localhost:55967&resources=none", true);

  xhr.onload = function (event) {
    var script = document.createElement('script'),
    src = URL.createObjectURL(event.target.response);
    script.src = src;
    document.body.appendChild(script);
  };
xhr.send();
</script></div>
</div>
<p>We can now watch data acquisition in real time! In the next lesson, we will go a few steps further: We will make an app with controls for starting, stopping, and saving acquisition that can stand alone on its own page in a browser (outside of a Jupyter notebook).</p>
<p>Before we end this lesson, we have to do the all-important closing of the serial connection!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">arduino</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Computing-environment">
<h2>Computing environment<a class="headerlink" href="#Computing-environment" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> watermark
<span class="o">%</span><span class="k">watermark</span> -v -p numpy,pandas,serial,bokeh,jupyterlab
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Python implementation: CPython
Python version       : 3.8.10
IPython version      : 7.22.0

numpy     : 1.20.2
pandas    : 1.2.4
serial    : 3.5
bokeh     : 2.3.2
jupyterlab: 3.0.14

</pre></div></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="l42_control_panels.html" class="btn btn-neutral float-right" title="Lesson 42: Control panels" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="l40_serial.html" class="btn btn-neutral float-left" title="Lesson 40: Control of external devices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
      <span class="lastupdated">
        Last updated on Jul 01, 2021.
      </span>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-65442910-1', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>